---
import RootLayout from "../../layouts/RootLayout.astro";
import { getCollection, type CollectionEntry } from "astro:content";

export async function getStaticPaths() {
    const projects = await getCollection("projects");
    return projects.map((project) => ({
        params: { slug: project.slug },
        props: { project },
    }));
}

type Props = {
    project: CollectionEntry<"projects">;
};

const { project } = Astro.props;
const { Content } = await project.render();

// Get all projects for navigation
const allProjects = await getCollection("projects");
const sortedProjects = allProjects.sort((a, b) => a.data.order - b.data.order);
---

<RootLayout>
    <div class="flex min-h-screen">
        <!-- Mobile Sidebar Overlay -->
        <div
            id="mobile-overlay"
            class="md:hidden fixed inset-0 bg-gray-900 bg-opacity-50 z-40 hidden"
        >
        </div>

        <!-- Left Sidebar -->
        <aside
            id="sidebar"
            class="fixed md:relative w-64 bg-bg-secondary border-r border flex-col z-50 transform -translate-x-full md:translate-x-0 transition-transform duration-300 ease-in-out hidden md:flex h-screen md:h-auto"
        >
            <!-- Close button for mobile -->
            <div class="md:hidden flex justify-end p-4">
                <button
                    id="close-menu"
                    class="text-text-secondary hover:text-text-nav-hover"
                >
                    <svg
                        class="w-6 h-6"
                        fill="none"
                        stroke="currentColor"
                        viewBox="0 0 24 24"
                    >
                        <path
                            stroke-linecap="round"
                            stroke-linejoin="round"
                            stroke-width="2"
                            d="M6 18L18 6M6 6l12 12"></path>
                    </svg>
                </button>
            </div>
            <!-- Logo/Header -->
            <div class="p-6 border-b border">
                <h1 class="text-text-accent text-xl font-semibold">
                    Daniel Benet
                </h1>
                <p class="text-text-secondary text-sm mt-1">
                    Frontend Developer
                </p>
            </div>

            <!-- Navigation -->
            <nav class="flex-1 p-4">
                <ul class="space-y-2">
                    <li>
                        <a
                            href="/"
                            class="flex items-center px-3 py-2 text-text-nav-primary hover:text-text-nav-hover hover:bg-bg-hover rounded-md transition-colors"
                        >
                            Introducci√≥n
                        </a>
                    </li>
                    {
                        sortedProjects.map((proj, index) => (
                            <li>
                                <a
                                    href={`/projects/${proj.slug}`}
                                    class={`flex items-center px-3 py-2 rounded-md transition-colors ${
                                        proj.slug === project.slug
                                            ? "text-text-nav-active bg-bg-selected"
                                            : "text-text-nav-secondary hover:text-text-nav-hover hover:bg-bg-hover"
                                    }`}
                                >
                                    <span
                                        class={
                                            index === 0
                                                ? "text-text-accent mr-3 text-sm font-bold"
                                                : "text-text-tertiary mr-3 text-sm"
                                        }
                                    >
                                        {String(index + 1).padStart(2, "0")}
                                    </span>
                                    {proj.data.title}
                                </a>
                            </li>
                        ))
                    }
                </ul>
            </nav>

            <!-- Footer -->
            <div class="p-4 border-t border">
                <p class="text-text-caption text-xs">Available for work</p>
            </div>
        </aside>

        <!-- Main Content -->
        <main class="flex-1 bg-bg-primary">
            <!-- Mobile Header -->
            <div
                class="md:hidden bg-bg-primary border-b border p-4 flex justify-between items-center"
            >
                <div>
                    <h1 class="text-xl font-semibold text-text-accent">
                        Daniel Benet
                    </h1>
                    <p class="text-text-secondary text-sm">
                        Frontend Developer
                    </p>
                </div>
                <button
                    id="open-menu"
                    class="text-text-secondary hover:text-text-nav-hover"
                >
                    <svg
                        class="w-6 h-6"
                        fill="none"
                        stroke="currentColor"
                        viewBox="0 0 24 24"
                    >
                        <path
                            stroke-linecap="round"
                            stroke-linejoin="round"
                            stroke-width="2"
                            d="M4 6h16M4 12h16M4 18h16"></path>
                    </svg>
                </button>
            </div>

            <div class="p-4 md:p-8">
                <div class="max-w-4xl">
                    <!-- Project Header -->
                    <div class="mb-8">
                        <h1
                            class="text-2xl md:text-4xl font-bold text-text-heading-primary mb-2"
                        >
                            {project.data.title}
                        </h1>
                        <p class="text-text-body text-lg mb-4">
                            {project.data.description}
                        </p>
                        <div
                            class="flex flex-wrap gap-4 text-sm text-text-caption"
                        >
                            <span
                                ><strong>Role:</strong>
                                {project.data.role}</span
                            >
                            <span
                                ><strong>Period:</strong>
                                {project.data.period}</span
                            >
                            <span
                                ><strong>Company:</strong>
                                {project.data.company}</span
                            >
                        </div>
                    </div>

                    <!-- Technologies -->
                    <div class="mb-8">
                        <h3
                            class="text-lg font-semibold text-text-heading-secondary mb-3"
                        >
                            Technologies
                        </h3>
                        <div class="flex flex-wrap gap-2">
                            {
                                project.data.technologies.map((tech) => (
                                    <span class="px-3 py-1 bg-bg-hover text-text-secondary rounded-full text-sm">
                                        {tech}
                                    </span>
                                ))
                            }
                        </div>
                    </div>

                    <!-- Project Content -->
                    <div class="prose prose-lg max-w-none">
                        <Content />
                    </div>
                </div>
            </div>
        </main>
    </div>

    <script>
        document.addEventListener("DOMContentLoaded", function () {
            const openMenu = document.getElementById("open-menu");
            const closeMenu = document.getElementById("close-menu");
            const sidebar = document.getElementById("sidebar");
            const overlay = document.getElementById("mobile-overlay");

            function openSidebar() {
                sidebar.classList.remove("hidden");
                sidebar.classList.remove("-translate-x-full");
                sidebar.classList.add("flex");
                overlay.classList.remove("hidden");
                document.body.style.overflow = "hidden";
            }

            function closeSidebar() {
                sidebar.classList.add("-translate-x-full");
                overlay.classList.add("hidden");
                document.body.style.overflow = "auto";

                // Hide sidebar after animation completes
                setTimeout(() => {
                    if (sidebar.classList.contains("-translate-x-full")) {
                        sidebar.classList.add("hidden");
                        sidebar.classList.remove("flex");
                    }
                }, 300);
            }

            openMenu.addEventListener("click", openSidebar);
            closeMenu.addEventListener("click", closeSidebar);
            overlay.addEventListener("click", closeSidebar);

            // Close menu when clicking on navigation links on mobile
            const navLinks = sidebar.querySelectorAll("nav a");
            navLinks.forEach((link) => {
                link.addEventListener("click", () => {
                    if (window.innerWidth < 768) {
                        closeSidebar();
                    }
                });
            });

            // Handle window resize
            window.addEventListener("resize", () => {
                if (window.innerWidth >= 768) {
                    sidebar.classList.remove("hidden", "-translate-x-full");
                    sidebar.classList.add("flex");
                    overlay.classList.add("hidden");
                    document.body.style.overflow = "auto";
                } else {
                    sidebar.classList.add("hidden", "-translate-x-full");
                    sidebar.classList.remove("flex");
                    overlay.classList.add("hidden");
                    document.body.style.overflow = "auto";
                }
            });
        });
    </script>
</RootLayout>
